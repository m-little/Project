doctype 5
html.all(style="background-image:url('../images/bg1.png');")

	include ../header

	div.all(style="max-width:1000px; margin:auto;")
		div(style="padding-bottom:20px; background-color:white;")

			- if (recipe.public == '0')
				div(style="float:left; clear:both; height:128px; width:24px; position:relative; top:24px; left:-18px; margin-bottom:-140px; background-image:url('../images/private.png');")

			//- Image
			div(style="width:100%; height:180px; border:1px solid #d6d6d6; overflow:hidden;")
				img(src="../images/user_images/#{recipe.picture.location}", style="width:100%; position:relative; top:-64px;", alt="#{recipe.picture.caption}", title="#{recipe.picture.caption}")

			//- Recipe Category
			div(style="position:relative; right:10px; top:-182px; font-size:28px; float:right; clear:both; width:auto; height:auto; padding-left:16px; padding-right:16px; margin-bottom:-36px; background-color:white; border-bottom-left-radius:.6em; border-bottom-right-radius:.6em; opacity:.8; filter:alpha(opacity=80); cursor:default;", title="Category")
				| #{recipe.category}

			//- Recipe Name
			div(style="position:relative; left:10px; top:-182px; font-size:32px; float:left; clear:both; width:auto; height:auto; padding-left:16px; padding-right:16px; margin-bottom:-36px; background-color:white; border-bottom-left-radius:.6em; border-bottom-right-radius:.6em; opacity:.8; filter:alpha(opacity=80); cursor:default;")
				| #{recipe.name}

			//- Owner
			div(style="position:relative; left:10px; top:-26px; font-size:16px; float:left; clear:both; width:auto; height:auto; padding:4px; padding-left:16px; padding-right:16px; background-color:white; border-top-left-radius:.6em; border-top-right-radius:.6em; opacity:.8; filter:alpha(opacity=80); cursor:default;")
				- if (recipe.owner == global.session.user.id)
					| Owned by You
				- else
					| Owned by 
					b(style="cursor:pointer;")
						| #{recipe.owner}


		div(style="font-size:16px; height:auto; padding:10px; border-top:1px dotted gray; background-color:white;")
			div(style="font-size:20px; float:right; clear:both;")
				| Serving Size
			div(style="font-size:18px; float:right; clear:both; padding-right:15px;")
				| #{recipe.serving_size}
			div(style="font-size:20px; float:right; clear:both;")
				| Prep Time
			div(style="font-size:18px; float:right; clear:both; padding-right:15px;")
				| #{recipe.prep_time}
			div(style="font-size:20px; background-color:white; width:100px; padding:2px;")
				| Ingredients
			table(style="margin-left:10px;")
				- for (var i = 0; i < (recipe.ingredients).length; i++)
					tr
						td(style="height:20px; padding-left:10px; padding-left:10px; padding-right:2px; margin:3px; text-align:right;")
							- if (recipe.ingredients[i].amount == .5)
								| 1/2
							- else if (recipe.ingredients[i].amount == .75)
								| 3/4
							- else if (recipe.ingredients[i].amount == .25)
								| 1/4
							- else if (recipe.ingredients[i].amount == .125)
								| 1/8
							- else if (recipe.ingredients[i].amount == .3333)
								| 1/3
							- else if (recipe.ingredients[i].amount == .6667)
								| 2/3
							- else
								| #{recipe.ingredients[i].amount} 
						td(style="padding-right:4px;")
							|  #{recipe.ingredients[i].unit_name}
							|  #{recipe.ingredients[i].name}
		div(style="font-size:16px; height:auto; padding:10px; border-top:1px dotted gray; background-color:white;")
			div(style="font-size:20px; background-color:white; width:100px; padding:2px;")
				| Directions
			div(style="padding-left:10px;")
				| #{recipe.directions}

		div(style="font-size:16px; height:auto; padding:10px; border-top:1px dotted gray; border-bottom:1px dotted gray; background-color:white;")
			div(style="font-size:20px; background-color:white; width:100px; padding:2px;")
				| Comments

			div(style="background-image:url('../images/bg2.png'); padding:5px; padding-top:1px; padding-bottom:1px; border-radius:.6em;")
				- for(var i = 0; i < recipe.flat_comments.length; i++)
					- comment = recipe.flat_comments[i];
					- if (recipe.owner == comment.owner)
						- comment_color = 'edefff';
					- else
						- comment_color = 'ffffff';

					div(style="padding:5px; padding-left:10px; margin:15px; margin-bottom:20px; margin-left:#{comment.indent * 50 + 10}px; border:1px solid gray; border-radius:.6em; height:auto; background-color:##{comment_color};")

						//- User stuff
						div(style="padding:5px; margin-right:10px; text-align:center; position:relative; left:-28px; top:-22px; margin-bottom:-24px; margin-right:-24px;")
							div(style="width:64px; height:64px; overflow:hidden;")
								img(style="width:100%;", src="../images/user_images/#{comment.picture.location}", alt="#{comment.picture.caption}", title="#{comment.picture.caption}")

						div(style="font-size:12px; color:gray; position:relative; left:46px; top:-50px; margin-bottom:-16px; width:260px;")
							| #{comment.date_added.toDateString()} at 
							- if (comment.date_added.getHours() > 12)
								| #{comment.date_added.getHours() - 12}
							- else
								| #{comment.date_added.getHours()}
							| :
							- if (comment.date_added.getMinutes() < 10)
								| 0
							| #{comment.date_added.getMinutes()}:
							- if (comment.date_added.getSeconds() < 10)
								| 0
							| #{comment.date_added.getSeconds()}
							- if (comment.date_added.getHours() > 12)
								|  pm
							- else
								|  am

						div(style="color:gray; position:relative; top:-28px; left:46px; margin-bottom:-16px; width:200px;")
							- if (comment.owner == global.session.user.id)
								| You said:
							- else
								| #{comment.owner} said:

						div(style="margin-left:5px; margin-right:5px; border-top:1px solid #dedede; border-radius:.2em; padding:4px; padding-left:5px; padding-right:5px;")
							| #{comment.content}

						div(style="background-image:url('../images/reply1.png'); width:59px; height:24px; margin-left:auto; cursor:pointer; position:relative; top:3px; margin-bottom:-20px;", title="Reply to this comment.")

		div(style="background-image:url('../images/comment1.png'); width:120px; height:26px; margin:auto; cursor:pointer; position:relative; top:-5px;", title="Comment on this recipe.")

	include ../footer